<!DOCTYPE html>
<html>
<head>
<link href="style.css" rel="stylesheet" />
<meta charset=utf-8 />
<meta name="viewport" content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
<title>Scheme as code</title>

<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>

<script src="https://unpkg.com/numeric/numeric-1.2.6.js"></script>
<script src="https://unpkg.com/layout-base/layout-base.js"></script>
<script src="https://unpkg.com/cose-base/cose-base.js"></script>
<script src="https://ivis-at-bilkent.github.io/cytoscape.js-fcose/cytoscape-fcose.js"></script>

<script src="code.js"></script>
</head>
<body>
<div id="cy"></div>
<script>
  
  const e = [
    { source: 'server', target: 'db cluster', label: 'grpc' },
    { source: 'client', target: 'server', label: 'request' },
  ];

  const g = [
    { id: 'db cluster', label: 'Main Database cluster'},
  ];

  const n = [
    { id: 'client', type: 'client', label: 'Our dear customer'},
    { id: 'server', type: 'server', label: 'Main Server'},
    { id: 'db1', type: 'database', group: 'db cluster', label: 'DB 1'},
    { id: 'db2', type: 'database', group: 'db cluster', label: 'DB 2'},
    { id: 'db3', type: 'database', group: 'db cluster', label: 'DB N'},
  ];

  const r = Diagram();
  r.edges(e);
  r.nodes(n);
  r.groups(g);
  r.render('cy');

</script>

<div id="cy2"></div>


<script>
  
  const elements = {
    groups: [
      { id: 'service-group1', label: 'Группа сервисов 1'},
      { id: 'service-group2', label: 'Группа сервисов 2'},
    ],
    nodes: [
      { id: 'client', type: 'client', label: 'Клиент'},
      
      { id: 'agent-backend', type: 'server', group: 'service-group1', label: 'agent-backend'},
      { id: 'web', type: 'server', group: 'service-group1', label: 'Приложение Записи мобильных'},
      { id: 'www', type: 'server', group: 'service-group1', label: 'страница загрузки'},
      { id: 'mongodb1', type: 'database', group: 'service-group1', label: 'Mongo DB 1'},
      { id: 'mongodb2', type: 'database', group: 'service-group1', label: 'Mongo DB 2'},
      { id: 'runner-integration1', type: 'server', group: 'service-group1', label: 'отправка'},
      { id: 'runner-integration2', type: 'server', group: 'service-group1', label: 'отправка'},
      { id: 'api', type: 'server', group: 'service-group1', label: 'API для внутренних сервисов'},

      { id: 'integration', type: 'server', group:'service-group2', label: 'Интеграция CRM'},
      { id: 'otherServer', type: 'server', group:'service-group2', label: 'сервер'},
      { id: 'firebase', type: 'server', label: 'Google Firebase'},
      { id: 'logger', type: 'server', group:'service-group2', label: 'Сервер логов'},
    ],
    edges: [
      { source: 'client', target: 'agent-backend', label: 'json данные' },
      { source: 'agent-backend', target: 'mongodb1' },
      { source: 'mongodb1', target: 'runner-integration1', label: 'данные' },
      { source: 'mongodb2', target: 'runner-integration2', label: 'данные' },
      { source: 'mongodb1', target: 'web', label: 'данные для отображения' },
      { source: 'runner-integration1', target: 'integration', label: 'данные' },
      { source: 'runner-integration2', target: 'otherServer', label: 'данныедля отчетов' },
      { source: 'api', target: 'firebase', label: 'данные для отчетов' },
      { source: 'firebase', target: 'client', label: 'данные в push-сообщениях' },
      { source: 'service-group1', target: 'logger', label: 'логи syslog' },
      // { source: 'integration', target: 'api', label: 'уведомления' },
    ],
  };

  Diagram('cy2', elements);
</script>

<div id="cy3"></div>


</body>
</html>
